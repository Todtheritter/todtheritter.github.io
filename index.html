<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>North Carolina Interactive Map</title>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body { margin: 0; }
    #map { height: 100vh; }
  </style>
</head>

<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Create map centered on North Carolina
    const map = L.map('map', {
      center: [35.5, -79],
      zoom: 7,
      minZoom: 6,
      maxZoom: 12,
      maxBounds: [
        [33.5, -85],
        [37, -75]
      ]
    });

    // Add basemap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Load district boundaries + vote data
    Promise.all([
      fetch('nc-house.geojson').then(r => r.json()),
      fetch('nc-house-reps-voteResultsfull.json').then(r => r.json())
    ]).then(([districtGeo, voteResults]) => {

      let geojson; // declared here so resetHighlight can access it

      function style(feature) {
        const district = feature.properties.DISTRICT;
        const info = voteResults[district];

        let fillColor = "transparent";
        let fillOpacity = 0;

        if (info && info.vote === "Yes") {
          fillColor = "#2ca25f";
          fillOpacity = 0.5;
        }

        return {
          color: "#444",
          weight: 1,
          fillColor: fillColor,
          fillOpacity: fillOpacity
        };
      }

      function highlightFeature(e) {
        e.target.setStyle({
          weight: 2,
          color: "#000"
        });
      }

      function resetHighlight(e) {
        geojson.resetStyle(e.target);
      }

      function onEachFeature(feature, layer) {
        const district = feature.properties.DISTRICT;
        const info = voteResults[district];

        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight
        });

        if (info) {
          layer.bindPopup(`
            <strong>District ${district}</strong><br>
            Representative: ${info.rep}<br>
            Party: ${info.party}<br>
            Tenure: ${info.tenure}<br>
            Vote: ${info.vote || "No data"}
          `);
        }
      }

      geojson = L.geoJSON(districtGeo, {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(map);

    })
    .catch(error => {
      console.error("Error loading map data:", error);
    });

  </script>
</body>
</html>



